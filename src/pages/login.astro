---
import Layout from "../layouts/Layout.astro";
import TerminalWindow from "@/components/TerminalWindow.astro";
import {
  CardHeader,
  CardTitle,
  CardContent,
  CardFooter,
} from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
---

<Layout>
  <div
    class="flex-1 flex flex-col items-center justify-center w-full max-w-md mx-auto px-0"
  >
    <TerminalWindow>
      <CardHeader
        className="border-b border-primary/20 pb-3 md:pb-4 text-center space-y-2"
      >
        <div
          class="mx-auto w-fit px-4 py-1 bg-destructive/10 border border-destructive/50 text-destructive font-mono text-xs uppercase tracking-widest animate-pulse"
        >
          Restricted Area
        </div>
        <CardTitle
          className="font-sans text-2xl uppercase tracking-widest text-foreground"
        >
          System Authorization Required
        </CardTitle>
      </CardHeader>

      <CardContent className="p-4 sm:p-6">
        <form class="flex flex-col gap-3 sm:gap-4" onsubmit="return false;">
          <div class="flex flex-col gap-3">
            <Label
              htmlFor="operativeId"
              className="font-mono text-xs uppercase text-primary tracking-widest flex items-center justify-between"
            >
              <span>Operative ID</span>
              <span class="text-[10px] text-muted-foreground mr-1"
                >FORMAT: X-0000X</span
              >
            </Label>
            <Input
              id="operativeId"
              placeholder="ENTER DESIGNATION"
              className="font-mono rounded-none border-border bg-background/50 focus-visible:ring-primary focus-visible:border-primary uppercase h-12 w-full"
            />
          </div>

          <div class="flex flex-col gap-3">
            <Label
              htmlFor="accessCode"
              className="font-mono text-xs uppercase text-primary tracking-widest"
            >
              Access Code
            </Label>
            <Input
              id="accessCode"
              type="password"
              placeholder="••••••••••••"
              className="font-mono rounded-none border-border bg-background/50 focus-visible:ring-primary focus-visible:border-primary tracking-widest h-12 w-full"
            />
          </div>

          <Button
            id="login-btn"
            type="button"
            className="w-full h-12 sm:h-14 rounded-none font-mono text-base sm:text-lg uppercase tracking-[0.2em] mt-2 shadow-[0_0_10px_rgba(var(--primary),0.3)] hover:shadow-[0_0_20px_rgba(var(--primary),0.5)] transition-all"
          >
            Authenticate
          </Button>
        </form>
      </CardContent>

      <CardFooter
        className="flex flex-col justify-center gap-2 border-t border-primary/20 pt-3 md:pt-4 font-mono text-sm"
      >
        <a
          href="/register"
          class="text-muted-foreground hover:text-primary transition-colors uppercase tracking-widest hover:underline decoration-primary underline-offset-4"
        >
          Request Access (Register)
        </a>
      </CardFooter>
    </TerminalWindow>

    <div
      class="mt-4 font-mono text-[10px] sm:text-xs text-muted-foreground/50 uppercase tracking-widest text-center max-w-[300px]"
    >
      Unauthorized access is a class 1 felony punishable by summary execution.
    </div>
  </div>
</Layout>

<script>
  import { toast } from "sonner";

  const loginBtn = document.getElementById("login-btn") as HTMLButtonElement;

  if (loginBtn) {
    loginBtn.addEventListener("click", () => {
      const originalText = loginBtn.innerText;
      loginBtn.innerText = "ENCRYPTING...";
      loginBtn.disabled = true;

      setTimeout(() => {
        toast.success("ACCESS GRANTED", {
          description: "OPERATIVE IDENTITY VERIFIED. WELCOME BACK.",
          className:
            "font-mono uppercase tracking-widest border-primary bg-background text-primary rounded-none",
        });

        loginBtn.innerText = originalText;
        loginBtn.disabled = false;

        // Minor delay before "redirecting" logic would go here
      }, 1500);
    });
  }
</script>
