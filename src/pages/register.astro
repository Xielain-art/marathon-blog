---
import Layout from "../layouts/Layout.astro";
import TerminalWindow from "@/components/TerminalWindow.astro";
import {
  CardHeader,
  CardTitle,
  CardContent,
  CardFooter,
} from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
---

<Layout title="Request Access">
  <div
    class="flex-1 flex flex-col items-center justify-center w-full max-w-md mx-auto px-0"
  >
    <TerminalWindow>
      <CardHeader
        className="border-b border-primary/20 pb-3 text-center space-y-1"
      >
        <CardTitle
          className="font-sans text-2xl uppercase tracking-widest text-foreground"
        >
          New Operative Enlistment
        </CardTitle>
        <p class="font-mono text-xs text-muted-foreground uppercase pt-1">
          UESC Standard Form 7A
        </p>
      </CardHeader>

      <CardContent className="p-4 sm:p-6">
        <form class="flex flex-col gap-3" onsubmit="return false;">
          <div class="flex flex-col gap-2">
            <Label
              htmlFor="email"
              className="font-mono text-xs uppercase text-primary tracking-widest"
            >
              Email Address
            </Label>
            <Input
              id="email"
              type="email"
              placeholder="USER@DOMAIN.COM"
              required
              className="font-mono rounded-none border-border bg-background/50 focus-visible:ring-primary focus-visible:border-primary uppercase h-12 w-full"
            />
          </div>

          <div class="flex flex-col gap-2">
            <Label
              htmlFor="accessCode"
              className="font-mono text-xs uppercase text-primary tracking-widest"
            >
              Create Access Code
            </Label>
            <Input
              id="accessCode"
              type="password"
              placeholder="••••••••"
              required
              minLength={8}
              className="font-mono rounded-none border-border bg-background/50 focus-visible:ring-primary focus-visible:border-primary tracking-widest h-12 w-full"
            />
          </div>

          <Button
            id="register-btn"
            type="button"
            className="w-full h-12 sm:h-14 rounded-none font-mono text-sm sm:text-base uppercase tracking-widest mt-2 bg-secondary text-secondary-foreground hover:bg-primary hover:text-primary-foreground border border-transparent hover:border-primary transition-all"
          >
            Initialize Registration
          </Button>
        </form>
      </CardContent>

      <CardFooter
        className="flex flex-col justify-center gap-2 border-t border-primary/20 pt-3 md:pt-4 font-mono text-sm"
      >
        <a
          href="/login"
          class="text-muted-foreground hover:text-primary transition-colors uppercase tracking-widest hover:underline decoration-primary underline-offset-4 flex items-center gap-2"
        >
          <span>&lt;</span> Return to Login
        </a>
      </CardFooter>
    </TerminalWindow>
  </div>
</Layout>

<script>
  import { toast } from "sonner";

  const registerBtn = document.getElementById(
    "register-btn",
  ) as HTMLButtonElement;

  if (registerBtn) {
    const form = registerBtn.closest("form");

    registerBtn.addEventListener("click", () => {
      if (form && !form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const originalText = registerBtn.innerText;
      registerBtn.innerText = "PROCESSING...";
      registerBtn.disabled = true;

      setTimeout(() => {
        toast.success("REGISTRATION COMPLETE", {
          description: "UESC FORM 7A SUBMITTED. CLEARANCE LEVEL 1 GRANTED.",
          className:
            "font-mono uppercase tracking-widest border-primary bg-background text-primary rounded-none",
        });

        registerBtn.innerText = originalText;
        registerBtn.disabled = false;
      }, 1500);
    });
  }
</script>
