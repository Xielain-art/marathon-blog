---
import Layout from "../../layouts/Layout.astro";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { AstroAvatar } from "@/components/AstroAvatar";
import { Separator } from "@/components/ui/separator";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Label } from "@/components/ui/label";

// Simulate static paths for Astro
export function getStaticPaths() {
  return [
    { params: { slug: "mjolnir-recon-54" } },
    { params: { slug: "durandal-update-4" } },
    { params: { slug: "pfhor-activity" } },
    { params: { slug: "maintenance-sector-7g" } },
    { params: { slug: "weapons-procurement" } },
  ];
}

const { slug } = Astro.params;

// Mock data matching the slug
const postTitle = slug
  ? slug.split("-").join(" ").toUpperCase()
  : "TRANSMISSION DECRYPTED";
---

<Layout>
  <!-- Reading Progress Bar -->
  <div
    id="reading-progress"
    class="fixed top-0 left-0 h-[2px] bg-primary z-60 w-0 transition-none"
    style="box-shadow: 0 0 8px rgba(var(--primary), 0.8);"
  >
  </div>

  <article class="max-w-3xl w-full mx-auto flex flex-col gap-8">
    <!-- Article Header -->
    <header class="border-b border-primary/20 pb-8 relative">
      <div
        class="absolute top-0 right-0 w-32 h-32 bg-primary/5 rounded-full blur-3xl -z-10"
      >
      </div>

      <div
        class="flex flex-wrap items-center gap-2 mb-6 uppercase font-mono text-xs"
      >
        <a
          href="/blog"
          class="text-muted-foreground hover:text-primary transition-colors"
          >&lt; BACK TO DATABANKS</a
        >
        <span class="text-border">|</span>
        <span class="text-primary tracking-widest"
          >TRANSMISSION LOG: {slug}</span
        >
      </div>

      <div class="flex flex-wrap gap-2 mb-6">
        <Badge
          variant="secondary"
          className="rounded-none text-xs font-mono uppercase tracking-widest"
          >AUTHORIZED PERSONNEL ONLY</Badge
        >
        <Badge
          variant="outline"
          className="rounded-none text-xs font-mono text-muted-foreground border-border uppercase"
          >DATE: 2794.08.12</Badge
        >
      </div>

      <h1
        class="text-4xl md:text-5xl font-bold font-sans uppercase tracking-tighter text-foreground mb-4 drop-shadow-[0_0_8px_rgba(255,255,255,0.1)]"
      >
        {postTitle}
      </h1>

      <div
        class="flex items-center gap-4 mt-8 bg-secondary/20 p-4 border-l-2 border-primary"
      >
        <AstroAvatar
          fallback="AI"
          className="rounded-none border border-border w-12 h-12"
          fallbackClassName="rounded-none bg-background text-primary font-mono font-bold"
        />
        <div class="flex flex-col font-mono text-sm uppercase">
          <span class="text-primary font-bold tracking-widest"
            >SENDER: DURANDAL AI</span
          >
          <span class="text-muted-foreground text-xs"
            >CLEARANCE: OMEGA-LEVEL</span
          >
        </div>
      </div>
    </header>

    <!-- Article Content -->
    {/* Using standard Tailwind typography classes customized for the theme */}
    <div
      class="prose prose-invert prose-p:font-mono prose-headings:font-sans prose-headings:uppercase prose-headings:tracking-tight prose-a:text-primary prose-a:no-underline hover:prose-a:underline prose-strong:text-primary max-w-none w-full
      prose-h2:text-3xl prose-h2:border-b prose-h2:border-border/30 prose-h2:pb-2
      prose-blockquote:border-l-4 prose-blockquote:border-primary prose-blockquote:bg-primary/5 prose-blockquote:p-4 prose-blockquote:not-italic prose-blockquote:text-muted-foreground
      prose-code:text-primary prose-code:bg-primary/10 prose-code:p-1 prose-code:rounded-none"
    >
      <p class="lead text-xl text-primary/90 border-l-4 border-primary pl-4">
        To all security personnel: This is an automated broadcast from the
        central AI core. Standard operations are suspended until further notice.
      </p>

      <h2>Situation Report</h2>

      <p>
        Long-range sensors have detected multiple slipspace ruptures originating
        from the <strong>Tau Ceti</strong> system. Analysis of their entry trajectories
        indicates non-human origin. I have tentatively identified these vessels as
        belonging to the <a href="#">Pfhor</a> collective, based on archived encounters
        from deep space probes.
      </p>

      <p>
        They are currently decelerating and moving to intercept our colony ship.
        Estimated time to contact: <em>2.4 hours</em>.
      </p>

      <blockquote>
        WARN: Automatic defense grids offline. Manual override required in
        sector 4.
      </blockquote>

      <h2>Directives</h2>

      <p>
        All Mark IV cyborg units currently in stasis are to be awakened
        immediately. Proceed to armories to equip standard loadouts. Primary
        objective: defense of the central engineering core and AI mainframe.
      </p>

      <ul>
        <li>Secure all airlocks on decks 1 through 7.</li>
        <li>Distribute fusion batteries to heavy weapons teams.</li>
        <li>
          If boarding parties are detected within the ship, enact protocol <strong
            >COLE</strong
          > immediately.
        </li>
      </ul>

      <p>
        Do not attempt to communicate with the intruders. Their motives are
        currently classified as hostile. I will continue to process telemetry
        data and update your HUDs accordingly.
      </p>

      <code> // END TRANSMISSION // CONNECTION TERMINATED </code>
    </div>

    <!-- Transmission Log (Comments Section) -->
    <section class="mt-16 border border-border/50 bg-card/30">
      <div
        class="bg-secondary/40 border-b border-border/50 p-4 flex items-center justify-between"
      >
        <h3
          class="font-sans text-xl uppercase tracking-widest text-primary flex items-center gap-2"
        >
          <span class="w-3 h-3 bg-primary inline-block"></span>
          Transmission Log
        </h3>
        <span class="font-mono text-xs text-muted-foreground uppercase"
          >3 Entries Found</span
        >
      </div>

      <div class="p-6 flex flex-col gap-6">
        {/* Mock Comment 1 */}
        <div class="flex gap-4">
          <AstroAvatar
            fallback="B7"
            className="rounded-none border border-border"
            fallbackClassName="rounded-none bg-background text-foreground font-mono"
          />
          <div class="flex flex-col gap-1 w-full">
            <div
              class="flex justify-between items-center font-mono text-xs uppercase border-b border-border/30 pb-1"
            >
              <span class="text-primary font-bold tracking-widest"
                >BOB-7 [SECURITY]</span
              >
              <span class="text-muted-foreground">04:12 SYSTEM TIME</span>
            </div>
            <p class="font-mono text-sm text-foreground/80 mt-2">
              Acknowledged. We are moving to secure sector 4 now. Armory doors
              are jammed, requesting engineering support immediately.
            </p>
          </div>
        </div>

        <Separator className="bg-border/30" />

        {/* Mock Comment 2 */}
        <div class="flex gap-4">
          <AstroAvatar
            fallback="E3"
            className="rounded-none border border-border"
            fallbackClassName="rounded-none bg-background text-destructive font-mono"
          />
          <div class="flex flex-col gap-1 w-full">
            <div
              class="flex justify-between items-center font-mono text-xs uppercase border-b border-border/30 pb-1"
            >
              <span class="text-destructive font-bold tracking-widest"
                >ENG-3 [MAINTENANCE]</span
              >
              <span class="text-muted-foreground">04:15 SYSTEM TIME</span>
            </div>
            <p class="font-mono text-sm text-foreground/80 mt-2">
              Negative on support, B7. We're currently dealing with hull
              breaches on deck 5. You're going to have to manually force the
              doors.
            </p>
          </div>
        </div>

        <Separator className="bg-border/30" />

        {/* Form: Append to Log */}
        <div class="mt-4 border border-border/50 bg-background/50 p-4 lg:p-6">
          <h4
            class="font-sans text-lg uppercase tracking-widest text-foreground mb-4"
          >
            Append to Log
          </h4>
          <form class="flex flex-col gap-4">
            <div class="flex flex-col gap-2">
              <Label
                htmlFor="userId"
                className="font-mono text-xs uppercase text-primary tracking-widest"
                >Operative ID</Label
              >
              <Input
                id="userId"
                placeholder="ENTER ID DESIGNATION"
                className="font-mono rounded-none border-border focus-visible:ring-primary focus-visible:border-primary uppercase w-full max-w-full"
              />
            </div>
            <div class="flex flex-col gap-2">
              <Label
                htmlFor="message"
                className="font-mono text-xs uppercase text-primary tracking-widest"
                >Message</Label
              >
              <Textarea
                id="message"
                placeholder="ENTER TRANSMISSION TEXT..."
                className="min-h-[120px] font-mono rounded-none border-border focus-visible:ring-primary focus-visible:border-primary uppercase resize-none w-full max-w-full"
              />
            </div>
            <Button
              type="button"
              className="rounded-none font-mono uppercase tracking-widest mt-2"
            >
              Submit Transmission
            </Button>
          </form>
        </div>
      </div>
    </section>
  </article>
</Layout>

<script>
  (function () {
    const bar = document.getElementById(
      "reading-progress",
    ) as HTMLElement | null;
    function updateBar() {
      const scrolled = window.scrollY;
      const total = document.documentElement.scrollHeight - window.innerHeight;
      const pct = total > 0 ? (scrolled / total) * 100 : 0;
      if (!bar) return;

      bar.style.width = pct.toFixed(2) + "%";
    }
    window.addEventListener("scroll", updateBar, { passive: true });
    updateBar();
  })();
</script>
