---
import {
  Card,
  CardHeader,
  CardTitle,
  CardDescription,
  CardContent,
  CardFooter,
} from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";

interface Post {
  title: string;
  excerpt: string;
  date: string;
  slug: string;
  tags: string[];
}

interface Props {
  post: Post;
  /** "card" = compact grid card (default), "list" = horizontal list row with image placeholder */
  variant?: "card" | "list";
}

const { post, variant = "card" } = Astro.props;
---

{
  variant === "card" ? (
    <Card className="rounded-none border-border/50 bg-card hover:border-primary/50 transition-colors flex flex-col group relative overflow-hidden">
      <div class="absolute inset-0 bg-primary/5 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none" />
      <CardHeader>
        <div class="flex flex-wrap gap-2 mb-3">
          {post.tags.map((tag) => (
            <Badge
              variant={tag === "SECURITY WARNING" ? "destructive" : "secondary"}
              className="rounded-none text-[10px] uppercase font-mono tracking-wider"
            >
              {tag}
            </Badge>
          ))}
        </div>
        <CardTitle className="font-sans text-xl uppercase tracking-tight group-hover:text-primary transition-colors">
          <a href={`/blog/${post.slug}`} class="before:absolute before:inset-0">
            {post.title}
          </a>
        </CardTitle>
        <CardDescription className="font-mono text-xs uppercase text-muted-foreground">
          Log Date: {post.date}
        </CardDescription>
      </CardHeader>
      <CardContent className="flex-1">
        <p class="font-mono text-sm text-foreground/80 line-clamp-3">
          {post.excerpt}
        </p>
      </CardContent>
      <CardFooter className="pt-4 border-t border-border/50">
        <span class="text-primary font-mono text-xs uppercase flex items-center gap-2 group-hover:tracking-widest transition-all">
          Read File -&gt;
        </span>
      </CardFooter>
    </Card>
  ) : (
    /* list variant — horizontal on md+, stacked on mobile */
    <Card className="rounded-none border-border/50 bg-card hover:border-primary/50 transition-colors flex flex-col md:flex-row group relative overflow-hidden h-full">
      <div class="absolute inset-x-0 bottom-0 h-1 bg-linear-to-r from-transparent via-primary/20 to-transparent scale-x-0 group-hover:scale-x-100 transition-transform duration-500" />

      {/* Thumbnail placeholder — hidden on mobile */}
      <div class="hidden md:flex flex-col items-center justify-center w-48 border-r border-border/50 bg-secondary/10 relative overflow-hidden shrink-0">
        <div class="absolute inset-0 bg-primary/5 pattern-grid-lg opacity-20 group-hover:opacity-40 transition-opacity" />
        <svg
          width="48"
          height="48"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="text-muted-foreground/30 group-hover:text-primary/50 transition-colors relative z-10"
        >
          <>
            <rect width="18" height="18" x="3" y="3" rx="2" ry="2" />
            <circle cx="9" cy="9" r="2" />
            <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21" />
          </>
        </svg>
        <span class="mt-4 font-mono text-[10px] text-muted-foreground/50 tracking-widest uppercase relative z-10 group-hover:text-primary/50 transition-colors">
          NO IMAGE DATA
        </span>
      </div>

      <div class="flex-1 flex flex-col justify-between py-2 min-w-0">
        <CardHeader className="pb-2">
          <div class="flex flex-wrap gap-2 mb-2">
            {post.tags.map((tag) => (
              <Badge
                variant={
                  tag === "SECURITY WARNING" ? "destructive" : "secondary"
                }
                className="rounded-none text-[10px] uppercase font-mono tracking-wider"
              >
                {tag}
              </Badge>
            ))}
            <Badge
              variant="outline"
              className="rounded-none text-[10px] uppercase font-mono border-border text-muted-foreground ml-auto"
            >
              {post.date}
            </Badge>
          </div>
          <CardTitle className="font-sans text-xl md:text-2xl uppercase tracking-tight group-hover:text-primary transition-colors wrap-break-word">
            <a
              href={`/blog/${post.slug}`}
              class="before:absolute before:inset-0"
            >
              {post.title}
            </a>
          </CardTitle>
        </CardHeader>
        <CardContent>
          <p class="font-mono text-sm text-foreground/80 line-clamp-2 md:line-clamp-3">
            {post.excerpt}
          </p>
        </CardContent>
      </div>

      {/* Right access column — hidden on mobile */}
      <div class="hidden md:flex flex-col items-center justify-center p-6 border-l border-border/50 bg-secondary/5 group-hover:bg-primary/5 transition-colors min-w-[80px]">
        <span class="text-primary font-mono text-xs tracking-widest uppercase rotate-90 whitespace-nowrap opacity-50 group-hover:opacity-100 transition-opacity transform origin-center">
          Access
        </span>
      </div>
    </Card>
  )
}
